---
title: "Data Preprocessing"
author: "Urity, Mounica and Reyes, Jacob"
date: "July 12, 2018"
output: word_document
---

```{r}
#load libraries
library(stringr)
library(sqldf)
library(tm)
library(tidytext)
library(qdap)
```

```{r}
#load dataset
wd = getwd()
file = paste(wd,"winemag_data_130k_v2.csv",sep="/")
wine_reviews = read.csv(file, head=TRUE, encoding="UTF-8",stringsAsFactors = FALSE)
#head(wine_reviews)
#summary(wine_reviews)
```

```{r}
#remove first column (an ID)
wine_reviews = wine_reviews[-1]

#count of region_2 = 50512 and a lot of time region_2 is the same as region_1 therefore, remove region_2
#remove twitter handle and taster name
wine_reviews = wine_reviews[-c(8:10)]

wine_reviews$title_clean = gsub('1912 Winemakers', "", wine_reviews$title)
wine_reviews$title_clean = gsub('Poderi dal Nespoli 1929', "", wine_reviews$title_clean)
wine_reviews$title_clean = gsub('Guidi 1929', "", wine_reviews$title_clean)
wine_reviews$title_clean = gsub('-', " ", wine_reviews$title_clean)

#parse out year (vintage)from wine description 
wine_reviews$vintage = as.numeric(str_extract(wine_reviews$title_clean,"(?:19|20)+[0-9]{2}"))

wine_reviews = subset(wine_reviews, select = -c(title_clean))

#replace region_1 with the region in the title column listed in ()
region_1 = str_extract(wine_reviews$title,"(?:\\()+(\\w+\\s*)+")
wine_reviews$region = str_extract(region_1, regex("(\\w)+(\\s)*(\\w)*(\\s)*(\\w)*", ignore_case = TRUE))
#head(wine_reviews)
wine_reviews = wine_reviews[-7]
```

```{r}
#creating unique identifier for each record (this is to join back after processing)
wine_reviews$id = (1:nrow(wine_reviews))

#creating df for text processing 
wine_text = wine_reviews[,c("id","description")]

#converting to lower case
wine_text$description_clean = tolower(wine_text$description)

#removing punctuation 
#wine_text$description_clean = str_replace_all(wine_text$description_clean, pattern = "[[:punct:]]", "")

#removing original description field to only keep id and cleaned description 
wine_text = subset(wine_text, select = -c(description))
```

```{r}
test = wine_text[1:10,]

#get number of words per wine description 
test$word_count = str_count(test$description_clean, pattern = "\\W+")

#creating corpus | turning records into documents
text_corpus = Corpus(VectorSource(test$description_clean))
#printing first 3 documents (reviews)
#inspect(text_corpus[1:3])   

text_corpus = tm_map(text_corpus, removeNumbers)
text_corpus = tm_map(text_corpus, removePunctuation)
text_corpus = tm_map(text_corpus,removeWords, stopwords("english"))
text_corpus = tm_map(text_corpus, stripWhitespace)

inspect(text_corpus[1:2])


```







